syntax = "proto3";

import "google/protobuf/timestamp.proto";

package webarchiver.archiver.v1;

service ArchiverService {
  rpc ListTasks (ListTasksRequest) returns (ListTasksResponse);
  rpc CreateTask (CreateTaskRequest) returns (Task);
  rpc CreateTaskStream (CreateTaskRequest) returns (stream Task);
  rpc GetTask (GetTaskRequest) returns (Task);
  rpc CancelTask (GetTaskRequest) returns (Task);
}

message ListTasksRequest {
  int32 page_size = 1;
  string page_token = 2;
  string order_by = 3;
}

message ListTasksResponse {
  repeated Task data = 1;
  string next_page_token = 2;
}

message GetTaskRequest {
  string id = 1;
}

message CreateTaskRequest {
  string url = 2;
  google.protobuf.Timestamp desired_date = 3;
  string quote = 4;
}

message Task {
  string id = 1;
  string url = 2;
  google.protobuf.Timestamp desired_date = 3;
  string quote = 4;

  enum Status {
    PENDING = 0;
    IN_PROGRESS = 1;
    DONE = 2;
    FAILED = 3;
    CANCELLED = 4;
  }

  Status status = 5;
  repeated Snapshot snapshots = 6;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}

message Snapshot {
  string id = 1;
  string uri = 2;

  enum Status {
    PENDING = 0;
    CHECKED = 1;
    FAILED = 2;
    CANCELLED = 3;
  }

  Status status = 3;
  google.protobuf.Timestamp captured_at = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}